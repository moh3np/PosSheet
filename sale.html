<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body {
        font-family: Arial, sans-serif;
        direction: rtl;
        background:#f5f5f5;
        padding:20px;
        padding-bottom:80px;
      }
      .product {
        margin-bottom: 15px;
        padding:10px;
        border:1px solid #ccc;
        border-radius:8px;
        background:#fff;
      }
      .label {
        display:inline-block;
        width:110px;
        font-weight:bold;
      }
      #products .sn {
        width:30%;
        font-size:18px;
        text-align:center;
        display:block;
        margin:0 auto 10px;
        padding:8px;
        border-radius:6px;
        border:1px solid #aaa;
      }
      .priceInput {
        width:150px;
        padding:4px;
        border-radius:4px;
        border:1px solid #aaa;
        text-align:center;
      }
      #totalDiv {
        margin-top:20px;
        font-size:20px;
        font-weight:bold;
        text-align:center;
      }
      #finalAmountDiv {
        margin-top:10px;
        font-size:18px;
        text-align:center;
      }
      #finalAmount {
        width:200px;
        padding:4px;
        border-radius:4px;
        border:1px solid #aaa;
        text-align:center;
      }
      #footer {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background:#fff;
        border-top:1px solid #ccc;
        text-align:center;
        padding:10px;
      }
      #footer button {
        padding:10px 20px;
        margin:0 5px;
        border:none;
        border-radius:4px;
        font-size:16px;
        cursor:pointer;
      }
      #footer button.submit {
        background:#4caf50;
        color:#fff;
      }
      #footer button.cancel {
        background:#f44336;
        color:#fff;
      }
    </style>
  </head>
  <body>
    <div id="products">
      <input class="sn" list="snList" placeholder="کد محصول">
    </div>
    <datalist id="snList"></datalist>
    <div id="totalDiv">
      جمع کل: <span id="total">0</span> تومان
    </div>
    <div id="finalAmountDiv">
      مبلغ نهایی: <input id="finalAmount" type="text" value="0"> تومان
    </div>
    <div id="footer">
      <button class="submit">ثبت</button>
      <button class="cancel" onclick="google.script.host.close()">لغو</button>
    </div>
    <script>
      var inventoryData = <?= JSON.stringify(inventoryData) ?>;
      document.addEventListener('DOMContentLoaded', function () {
        var snList = document.getElementById('snList');
        inventoryData.sn.forEach(function (sn) {
          var option = document.createElement('option');
          option.value = sn;
          snList.appendChild(option);
        });
        var snInput = document.querySelector('#products .sn');
        snInput.addEventListener('keydown', function (e) {
          if (e.key === 'Enter') {
            var code = snInput.value.trim();
            var index = inventoryData.sn.indexOf(code);
            if (index !== -1) {
              addRow(index);
            }
            snInput.value = '';
            e.preventDefault();
          }
        });

        function addRow(idx) {
          var table = document.getElementById('productTable');
          if (!table) {
            table = document.createElement('table');
            table.id = 'productTable';
            table.style.width = '100%';
            table.style.borderCollapse = 'collapse';
            var header = document.createElement('tr');
            ['محصول', 'سریال', 'موقعیت', 'قیمت'].forEach(function (title) {
              var th = document.createElement('th');
              th.textContent = title;
              th.style.border = '1px solid #ccc';
              th.style.padding = '4px';
              header.appendChild(th);
            });
            table.appendChild(header);
            document.getElementById('products').appendChild(table);
          }
          var tr = document.createElement('tr');
          [inventoryData.name[idx], inventoryData.sn[idx], inventoryData.location[idx], inventoryData.price[idx]].forEach(function (value) {
            var td = document.createElement('td');
            td.textContent = value;
            td.style.border = '1px solid #ccc';
            td.style.padding = '4px';
            tr.appendChild(td);
          });
          table.appendChild(tr);
        }
      });
    </script>
  </body>
</html>
